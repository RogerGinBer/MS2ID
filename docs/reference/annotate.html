<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Annotate MS/MS spectra against a reference library — annotate • MS2ID</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Annotate MS/MS spectra against a reference library — annotate" />
<meta property="og:description" content="annotate is the MS2ID function that annotates MS/MS query spectra.
Every query spectrum is compared with a reference library
(MS2ID object) using as criteria different distance metrics;
the function returns query and reference spectra (and their compounds) that
beat a determined threshold." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MS2ID</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/MS2ID.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/annotate.html">Annotate query spectra</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jmbadia/MS2ID/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Annotate MS/MS spectra against a reference library</h1>
    <small class="dont-index">Source: <a href='https://github.com/jmbadia/MS2ID/blob/master/R/annotate.R'><code>R/annotate.R</code></a></small>
    <div class="hidden name"><code>annotate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>annotate</code> is the MS2ID function that annotates MS/MS query spectra.
Every query spectrum is compared with a reference library
(<a href='MS2ID.html'>MS2ID</a> object) using as criteria different distance metrics;
the function returns query and reference spectra (and their compounds) that
beat a determined threshold.</p>
    </div>

    <pre class="usage"><span class='fu'>annotate</span><span class='op'>(</span>
  <span class='va'>QRYdata</span>,
  QRYmsLevel <span class='op'>=</span> <span class='fl'>2L</span>,
  <span class='va'>MS2ID</span>,
  metrics <span class='op'>=</span> <span class='st'>"cosine"</span>,
  metricsThresh <span class='op'>=</span> <span class='fl'>0.8</span>,
  metricFUN <span class='op'>=</span> <span class='cn'>NULL</span>,
  metricFUNThresh <span class='op'>=</span> <span class='cn'>NULL</span>,
  massErrMs1 <span class='op'>=</span> <span class='fl'>5</span>,
  massErrMsn <span class='op'>=</span> <span class='fl'>20</span>,
  noiseThresh <span class='op'>=</span> <span class='fl'>0.01</span>,
  cmnPrecMass <span class='op'>=</span> <span class='cn'>FALSE</span>,
  cmnNeutralMass <span class='op'>=</span> <span class='cn'>TRUE</span>,
  cmnFrags <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>5</span><span class='op'>)</span>,
  cmnPolarity <span class='op'>=</span> <span class='cn'>TRUE</span>,
  predicted <span class='op'>=</span> <span class='cn'>NULL</span>,
  consens <span class='op'>=</span> <span class='cn'>TRUE</span>,
  consCos <span class='op'>=</span> <span class='fl'>0.8</span>,
  consComm <span class='op'>=</span> <span class='fl'>2</span><span class='op'>/</span><span class='fl'>3</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>QRYdata</th>
      <td><p>Query spectra. <code><a href='https://rdrr.io/pkg/Spectra/man/Spectra.html'>Spectra</a></code>(1) object (see
<a href='https://bioconductor.org/packages/3.14/Spectra'>Spectra</a> package) or
character(1) with the directory name containing the mzML files.</p></td>
    </tr>
    <tr>
      <th>QRYmsLevel</th>
      <td><p>integer(1). This argument filters the query spectra loaded
from mzML files according their msLevel.</p></td>
    </tr>
    <tr>
      <th>MS2ID</th>
      <td><p><a href='MS2ID.html'>MS2ID</a> object with the in-house database to use in
the annotation.</p></td>
    </tr>
    <tr>
      <th>metrics</th>
      <td><p>character(n) that defines which metrics use to compare query
and reference spectra (<code>annotate</code> function trims the result according
the <code>metricsThresh</code> parameter). Values are restricted to 'cosine',
'topsoe', 'fidelity' and 'squared_chord'. See
<code><a href='https://rdrr.io/pkg/philentropy/man/distance.html'>distance</a></code> function in philentropy package for
more information.</p></td>
    </tr>
    <tr>
      <th>metricsThresh</th>
      <td><p>numeric(n) defining the n threshold values of the n
metrics. A reference spectrum is considered a hit and listed in the return
object when <strong>at least one of the metrics</strong> fulfills its threshold;
note that to fulfill a threshold value has a different meaning depending on
the metric: topsoe and squared_chord metrics return a lower number when the
spectra are more similar so, unlike the rest, a hit will occur when the
returned value is lower than its threshold. Recommended values to start
with are cosine=0.8, topsoe=0.6, fidelity=0.6 and squared_chord=0.8.</p></td>
    </tr>
    <tr>
      <th>metricFUN</th>
      <td><p>function(1) defined by the user to be used as metric. This
function must accept a two-row matrix as a parameter; each row must contain
the intensity of a spectrum, and each column must refer to the same m/z
value (considering the massErrMsn parameter as the mass error). Finally,
the function must return a numeric(1). See example.</p></td>
    </tr>
    <tr>
      <th>metricFUNThresh</th>
      <td><p>numeric(1) with the threshold value of the metric
defined by the <code>metricFUN</code> parameter. metricFUN / metricFUN are
analogous to metrics / metricsThresh parameters.</p></td>
    </tr>
    <tr>
      <th>massErrMs1</th>
      <td><p>numeric(1). Mass error to consider in operations with first
spectrometer measures (MS1), e.g. grouping spectra according its precursor
mass (in consensus formation) or evaluating precursor and neutral masses
similarities (in reference spectra prefiltering),</p></td>
    </tr>
    <tr>
      <th>massErrMsn</th>
      <td><p>numeric(1) Mass error to consider in operations with
non-first spectrometer measures (typically MS2). e.g. matching fragments,
for consensus formation or distance similarity measures.</p></td>
    </tr>
    <tr>
      <th>noiseThresh</th>
      <td><p>numeric(1) defining the threshold used in the noise
filtering of the query spectra. It is expressed as % intensity relative to
base peak. e.g. noiseThresh=0.01 eliminates peaks with an intensity of less
than 1% of the base peak.</p></td>
    </tr>
    <tr>
      <th>cmnPrecMass</th>
      <td><p>-Reference spectra filter- Boolean(1) that limits the
reference spectra to those that have the precursor mass of the query
spectrum.</p></td>
    </tr>
    <tr>
      <th>cmnNeutralMass</th>
      <td><p>-Reference spectra filter- Boolean filtering the
reference spectra to those with a neutral mass plausible with the query
precursor (considering all possible adducts).</p></td>
    </tr>
    <tr>
      <th>cmnFrags</th>
      <td><p>-Reference spectra filter- vector with two integers (m, n)
limiting the reference spectra so that both query and reference spectra
have at least m peaks in common among their top n most intense peaks.</p></td>
    </tr>
    <tr>
      <th>cmnPolarity</th>
      <td><p>-Reference spectra filter- Boolean(1) that limits the
reference spectra to those with the same polarity than the query spectrum.</p></td>
    </tr>
    <tr>
      <th>predicted</th>
      <td><p>-Reference spectra filter- Boolean(1) filtering the
reference spectra according its experimental nature (in-silico or
predicted). A NULL value does not apply filter.</p></td>
    </tr>
    <tr>
      <th>consens</th>
      <td><p>boolean(1) indicating if the query spectra must be consensued
or not.</p></td>
    </tr>
    <tr>
      <th>consCos</th>
      <td><p>numeric(1) with the minimum cosine similarity two
contiguous spectra must have to consens a spectrum.</p></td>
    </tr>
    <tr>
      <th>consComm</th>
      <td><p>numeric(1) During the consensus formation, minimum presence of
m/z in the query spectra in order to be part of the final consensus
spectrum.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other arguments passed to function</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>an <a href='Annot.html'>Annot</a> object with the results of the annotation</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='Annot.html'>Annot</a> class and the post annotation tools
  <code><a href='MS2IDgui.html'>MS2IDgui</a></code> and <code><a href='export2xlsx.html'>export2xlsx</a></code>.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Josep M. Badia <a href='mailto:josepmaria.badia@urv.cat'>josepmaria.badia@urv.cat</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>## LOAD MS2ID LIBRARY ---</span>
<span class='co'>## Decompress the MS2ID library that comes with MS2ID</span>
<span class='va'>MS2IDzipFile</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata/MS2IDLibrary.zip"</span>,
                            package <span class='op'>=</span> <span class='st'>"MS2ID"</span>,
                            mustWork <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>utils</span><span class='op'>)</span>
<span class='va'>MS2IDFolder</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/basename.html'>dirname</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/unzip.html'>unzip</a></span><span class='op'>(</span><span class='va'>MS2IDzipFile</span>,
                             exdir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>

<span class='co'>## SELECT QUERY SPECTRA ---</span>
<span class='co'>## Decompress the query mzML files that come with MS2ID</span>
<span class='va'>queryFile</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata/QRYspectra.zip"</span>,
                         package <span class='op'>=</span> <span class='st'>"MS2ID"</span>,
                         mustWork <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>queryFolder</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='st'>"QRYspectra"</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>utils</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/unzip.html'>unzip</a></span><span class='op'>(</span><span class='va'>queryFile</span>, exdir <span class='op'>=</span> <span class='va'>queryFolder</span><span class='op'>)</span>

<span class='co'>## ANNOTATE ---</span>
<span class='co'>## 3.1 Simple annotation</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://jmbadia.github.io/MS2ID/index.html'>MS2ID</a></span><span class='op'>)</span>
<span class='va'>MS2IDlib</span> <span class='op'>&lt;-</span> <span class='fu'><a href='MS2ID.html'>MS2ID</a></span><span class='op'>(</span><span class='va'>MS2IDFolder</span><span class='op'>)</span>
<span class='va'>annotResult</span> <span class='op'>&lt;-</span> <span class='fu'>annotate</span><span class='op'>(</span>QRYdata <span class='op'>=</span> <span class='va'>queryFolder</span>,
                        MS2ID <span class='op'>=</span> <span class='va'>MS2IDlib</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading query spectra ...</span></div><div class='output co'>#&gt; <span class='message'>Obtaining consensus spectra ...</span></div><div class='output co'>#&gt; <span class='message'>Solving distance metrics between query and reference spectra ...</span></div><div class='output co'>#&gt; <span class='message'>Processing results obtained ...</span></div><div class='input'><span class='co'>## 3.2 Annotation with different metrics</span>
<span class='co'>## external function to annotate</span>
<span class='va'>foo</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>finalMatrix</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>vector1</span> <span class='op'>&lt;-</span> <span class='va'>finalMatrix</span><span class='op'>[</span><span class='fl'>1</span>, <span class='op'>]</span>
  <span class='va'>vector2</span> <span class='op'>&lt;-</span> <span class='va'>finalMatrix</span><span class='op'>[</span><span class='fl'>2</span>, <span class='op'>]</span>
  <span class='va'>CosplusOne</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/message.html'>suppressMessages</a></span><span class='op'>(</span>
    <span class='fu'>philentropy</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/philentropy/man/distance.html'>distance</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>vector1</span>, <span class='va'>vector2</span><span class='op'>)</span>,
                          method <span class='op'>=</span> <span class='st'>"cosine"</span><span class='op'>)</span>
  <span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>CosplusOne</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"CosplusOne"</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>CosplusOne</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>annotResult</span> <span class='op'>&lt;-</span> <span class='fu'>annotate</span><span class='op'>(</span>
  QRYdata <span class='op'>=</span> <span class='va'>queryFolder</span>, MS2ID <span class='op'>=</span> <span class='va'>MS2IDlib</span>,
  metrics <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"cosine"</span>, <span class='st'>"fidelity"</span>, <span class='st'>"topsoe"</span><span class='op'>)</span>,
  metricsThresh <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.8</span>, <span class='fl'>0.6</span>, <span class='fl'>0.6</span><span class='op'>)</span>,
  metricFUN <span class='op'>=</span> <span class='va'>foo</span>, metricFUNThresh <span class='op'>=</span> <span class='fl'>1.8</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading query spectra ...</span></div><div class='output co'>#&gt; <span class='message'>Obtaining consensus spectra ...</span></div><div class='output co'>#&gt; <span class='message'>Solving distance metrics between query and reference spectra ...</span></div><div class='output co'>#&gt; <span class='message'>Processing results obtained ...</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Josep M. Badia.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


